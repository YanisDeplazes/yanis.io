---
interface ProjectData {
  title: string;
  description: string;
  start: Date;
  end?: Date;
  type: string[];
  thumbnail: string;
  selected: boolean;
  ongoing: boolean;
  gallery?: {
    content?: { imageUrl?: string; alt?: string; videoUrl?: string }[];
  };
}

interface Project {
  id: string;
  data: ProjectData;
  body: string;
  filePath: string;
  digest: string;
  rendered: {
    html: string;
    metadata: any;
  };
  collection: string;
  slug: string;
  render: () => Promise<any>;
}

import { getCollection, getEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Image from '../../assets/images/default.png';
import Gallery from '../../components/sections/Gallery.astro';
import Lightbox from '../../components/sections/Lightbox.astro';
import Description from '../../components/sections/Description.astro';

const { slug } = Astro.params;

const loadProject = await getEntry('work', slug);

if (!loadProject) {
  throw new Error(`Project not found: ${slug}`);
}

const { title, description, end, type, ongoing, start, gallery } =
  loadProject.data;

const suffix = 'Yanis Deplazes';

// Render project content
const { Content } = await loadProject.render();

// Generate static paths for all projects (slug-based)
export async function getStaticPaths() {
  const work = await getCollection('work');
  return work.map((project) => ({
    params: { slug: project.slug },
  }));
}
---

<Layout
  title={`${title} â€” ${suffix}`}
  description={description}
  imageSrc={Image.src}
>
  <Description
    title={title}
    start={start}
    end={end}
    ongoing={ongoing}
    type={type.join(', ')}
  >
    <Content />
  </Description>

  {gallery && <Gallery galleryData={gallery.content} />}
  <Lightbox galleryData={gallery?.content} />
</Layout>
