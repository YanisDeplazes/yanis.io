---
import Wrapper from '../../layouts/Wrapper.astro';
import SelectedWrapper from '../wrappers/SelectedWrapper.astro';
import { getCollection } from 'astro:content';

const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/images/**/*.{jpg,jpeg,png,webp}',
);

const resolveImage = async (url: string) => images[`/src/assets${url}`]?.();
const work = (await getCollection('work'))
  .filter(({ data }) => data.selected === true)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const resolvedSelected = await Promise.all(
  work.map(async ({ data, slug }) => ({
    slug,
    date: new Date(data.date).getFullYear(),
    title: data.title,
    type: data.type.join(', '),
    ongoing: data.ongoing,
    color: data.color,
    resolvedThumbnail: data.thumbnail
      ? (await resolveImage(data.thumbnail))?.default
      : undefined,
  })),
);
---

<section class="selection">
  <Wrapper>
    <div class="content">
      {
        resolvedSelected.map(
          (item) =>
            item.resolvedThumbnail && (
              <section
                class="item reveal-on-scroll"
                data-background={item.color}
              >
                <SelectedWrapper
                  slug={item.slug}
                  date={item.date}
                  title={item.title}
                  type={item.type}
                  src={item.resolvedThumbnail}
                  ongoing={item.ongoing}
                />
              </section>
            ),
        )
      }
    </div>
  </Wrapper>
</section>

<style lang="scss">
  .selection {
    .content {
      display: flex;
      align-items: center;
      flex-direction: column;
    }
  }
</style>
